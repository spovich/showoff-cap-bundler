<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Capistrano & Bunder</title>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  
    <link rel="stylesheet" href="file/showoff.css" type="text/css"/>
  

  

  <script type="text/javascript">
  $(function(){
    setupPreso(false, './');
  });
  </script>
</head>

<body>


<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">&larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">z</td><td>toggle help (this)</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content center" ref="title/title">
<p><img src="./file/title/renorb-logo.png" width="385" height="145" alt="#reno.rb logo"/></p>

<h1>Capistrano &amp; Bundler</h1>

<h1>Oct 25, 2010</h1></div>
</div><div class="slide" data-transition="fade"><div class="content bullets incremental" ref="overview/overview/1">
<p class="notes">list main points of talk</p>

<h1>Talk Overview</h1>

<ul>
<li>Prerequisites</li>
<li>Capistrano Basics</li>
<li>Bundler Basics</li>
<li>Putting it all together</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="overview/overview/2">
<h1>Prerequisites</h1>

<ul>
<li>SSH</li>
<li>If you don't like typing passwords over and over, SSH Keys, SSH Agent, SSH Agent Forwarding</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="cap/0-intro/1">
<h1>Capistrano Basics</h1>

<ul>
<li>20,000 ft Capistrano</li>
<li>Install Capistrano</li>
<li><a href="http://www.capify.org">Capistrano Documentation</a></li>
<li>Cap'ify your app</li>
<li>Cap Recommendations</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="cap/0-intro/2">
<h1>20,000 ft Capistrano</h1>

<ul>
<li>What is it?</li>
<li>How does it work?</li>
<li>Why should I use it?</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="cap/0-intro/3">
<h1>Install Capistrano</h1>

<pre><code><code class="command">$gem install capistrano
Successfully installed capistrano-2.5.19
1 gem installed
Installing ri documentation for capistrano-2.5.19...
Installing RDoc documentation for capistrano-2.5.19...</code><code class="result"></code></code>


<p/></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="cap/0-intro/4">
<h1>Cap'ify your app</h1>

<ul>
<li>Need 'Capfile' in your app root</li>
<li>For rails, 'Capfile' loads config/deploy.rb</li>
<li>For this talk, I will use 'Capfile' and 'deploy.rb' interchangeably</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline" ref="cap/0-intro/5">
<h1>Cap'ifisticationalizing</h1>

<ul>
<li><pre><code>$capify ./
[add] writing <code>./Capfile'
[add] writing</code>./config/deploy.rb'
[done] capified!</code></pre></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="cap/1-capfile/1">
<h1>Anatomy of a Capfile</h1>

<ul>
<li>Environment/Variables</li>
<li>Roles</li>
<li>Tasks</li>
<li>Show Working Capfile</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="cap/1-capfile/2">
<h1>Capfile Variables</h1>

<ul>
<li>Set them</li>
<li>Prompt for them</li>
<li>Use them!</li>
<li><a href="http://github.com/capistrano/capistrano/wiki/2.x-Significant-Configuration-Variables">Capfile Variables Documentation</a></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline" ref="cap/1-capfile/3">
<h1>Capfile Environment/Variables</h1>

<pre style="font-size: 1.7em;">
set :application, 'foo' # system
set :user, 'bar' # system

set :rake, '/opt/ree/bin/rake' # system
set :web_root, '/var/www' # system

set :staging_server, 'tacquito.foobar.com' # arbitrary
set :production_server, 'chalupa.foobar.com' # arbitrary

set :scm, :git # system
set :repository, "git@git.foobar.com:#{application}.git" # system

branch = Capistrano::CLI.ui.ask("Deploy branch ('master' is default): ")
branch = 'master' if branch.empty?
set :branch, branch # system
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets commandline" ref="cap/1-capfile/4">
<h1>Capfile Roles</h1>

<ul>
<li>Declare which server takes which role</li>
</ul>


<pre style="margin-left: 200px">
role :app, 'www.foobar.com'
role :web, 'www.foobar.com'
role :db, 'www.foobar.com'
</pre>


<ul>
<li>OR declare a 'server' for simpler configs</li>
</ul>


<pre style="margin-left: 200px">
server 'www.foobar.com', :app, :web, :db
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets commandline" ref="cap/1-capfile/5">
<h1>Capfile Tasks</h1>

<ul>
<li>Can do anything you can do from shell</li>
<li>Can run application rake tasks</li>
<li>List Capfile Tasks</li>
</ul>


<pre style="margin-left: 200px">
$ cap -T
</pre>


<ul>
<li>Simple Capfile Task</li>
</ul>


<pre style="margin-left: 200px">
desc "List Remote Web Root"
task :list_web_root, :roles =&gt; :web do
  run "ls -la /var/www"
end
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="cap/1-capfile/6">
<h1>Disect a working Capfile</h1>

<ul>
<li>[jump to text editor]</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="cap/2-deploy/1">
<h1>Capistrano Deploy</h1>

<ul>
<li>Strategy</li>
<li>Dependencies (Bundler)</li>
<li>Deploy Tasks</li>
<li>Task Hooks</li>
<li>Sample Deploy</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets commandline" ref="cap/2-deploy/2">
<h1>Deploy Strategy</h1>

<ul>
<li>Maintain git repo on the server</li>
<li>Define how and where to put code</li>
</ul>


<pre style="margin-left: 200px">
set :use_sudo, false
set :deploy_to, "#{web_root}/#{user}/#{application}"
set :deploy_via, :remote_cache
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="cap/2-deploy/3">
<h1>Deploy Dependencies</h1>

<ul>
<li>Manually script apt/rpm deps (Im ageMagick, etc)</li>
<li>Bundler handles ruby deps</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="cap/2-deploy/4">
<h1>Deploy Tasks</h1>

<ul>
<li>'cap deploy' runs standard tasks (callback'able)</li>
</ul>


<pre style="margin-left: 200px">
# cap deploy:update
# cap deploy:symlink
# cap deploy:restart
</pre>


<ul>
<li>'cap deploy' won't run first time until setup</li>
</ul>


<pre style="margin-left: 200px">
# cap deploy:setup
# cap deploy:check
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="cap/2-deploy/5">
<h4>http://github.com/leehambley/capistrano-documentation-support-files/</h4>

<p><img src="./file/cap/cap-execution-path.jpg" width="1287" height="652" alt="Capistrano Execution Path http://github.com/leehambley/capistrano-documentation-support-files/"/></p></div>
</div><div class="slide" data-transition="none"><div class="content bullets commandline" ref="cap/2-deploy/6">
<h1>Task Hooks</h1>

<ul>
<li>Extend standard deploy task via callbacks</li>
</ul>


<pre style="margin-left: 100px">
before 'deploy', 'deploy:check'
before 'deploy', 'deploy:web:disable'

after 'deploy:update_code', 'bundler:bundle_install'
after 'deploy:update_code', 'app_setup' if run_app_setup
after 'deploy:update_code', 'db_migrate'

after 'deploy:symlink', 'clear_cache'

after 'deploy', 'deploy:web:enable'
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="cap/2-deploy/7">
<h1>Sample Deploy</h1>

<ul>
<li>[jump to shell]</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="cap/3-misc">
<h1>Cap Recommendations</h1>

<ul>
<li>If you don't use multistage, you aren't testing!</li>
<li>Do multistage with or without capistrano-ext.</li>
<li>Test your production recipe on staging first!</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="bundler/0-intro/1">
<h1>Bundler Basics</h1>

<ul>
<li>20,000 ft Bundler</li>
<li>Install Bundler</li>
<li><a href="http://gembundler.com/">Bundler Documentation</a></li>
<li>Bundle your app</li>
<li>Bundler Recommendations</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="bundler/0-intro/2">
<h1>20,000 ft Bundler</h1>

<ul>
<li>What is it?</li>
<li>How does it work?</li>
<li>Why should I use it?</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="bundler/0-intro/3">
<h1>Install Bundler</h1>

<pre><code><code class="command">$gem install bundler
Successfully installed bundler-1.0.3
1 gem installed
Installing ri documentation for bundler-1.0.3...
Installing RDoc documentation for bundler-1.0.3...</code><code class="result"></code></code>


<p/></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="bundler/0-intro/4">
<h1>Bundle your app</h1>

<ul>
<li>Need 'Gemfile' in your app root</li>
<li>Baked into Rails 3</li>
<li>'bundle init' for others (sinatra, etc)</li>
<li><a href="http://gembundler.com/rails23.html">Bundler rails 2.3.x How To</a></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="bundler/1-gemfile/1">
<h1>Anatomy of a Gemfile</h1>

<ul>
<li><a href="http://gembundler.com/man/gemfile.5.html">Gemfile Syntax</a></li>
<li>Evaluated as Ruby code</li>
<li>Sources options</li>
<li>Gems options</li>
<li>Using Blocks in Gemfile</li>
<li>Sample Gemfile</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="bundler/1-gemfile/2">
<h1>Gemfile 'source'</h1>

<ul>
<li>Must be valid rubygems repositories</li>
<li>Roll your own, if you are adventurous</li>
<li>Can have multiple sources</li>
<li>Searched in order of declaration</li>
<li>Individual gem can have a source</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="bundler/1-gemfile/3">
<h1>Gemfile 'gem'</h1>

<ul>
<li>Only gem name is required</li>
<li>Everything else is optional</li>
<li>Options: version, require, platforms (jruby), git, path</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="bundler/1-gemfile/4">
<h1>Gemfile Blocks</h1>

<ul>
<li>Group block is most commonly used</li>
<li>Only install those gems in the specified environment</li>
<li>Allows you to not pollute production with dev &amp; testing gems</li>
<li>Other block forms: Git, Path, Platforms</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline" ref="bundler/1-gemfile/5">
<h1>Sample Gemfile</h1>

<pre style="font-size: 1.4em;">
source 'http://rubygems.org'

gem 'rails',                  '= 3.0.1'
gem 'pg',                     '~&gt; 0.9.0'
gem 'exception_notification', :git =&gt; 'http://github.com/rails/exception_notification.git'
gem 'will_paginate',          :path =&gt; 'vendor/rails' # custom version of gem
gem 'nokogiri',               :platforms =&gt; [:mri_18, :jruby]

group :development, :test do
  gem 'redgreen'
  gem 'silent-postgres'
  gem 'ruby-debug'
  gem 'rspec-rails', '~&gt; 2.0.1'
end
</pre>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="bundler/2-bundle/1">
<h1>Bundle Install</h1>

<pre><code><code class="command">$bundle install
Using rake (0.8.7) 
Using abstract (1.0.0) 
Using activesupport (3.0.1) 
...
Your bundle is complete! It was installed into /Users/foo/.rvm/gems/ree-1.8.7-2010.02@bar
</code><code class="result"></code></code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="bundler/2-bundle/2">
<h1>Bundle Install vs. Update</h1>

<ul>
<li>'bundle install' is conservative (won't update gems not explicitly updated in Gemfile.lock).</li>
<li>'bundle update' resolves all dependencies from scratch (ignores Gemfile.lock)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="bundler/2-bundle/3">
<h1>Bundle Install --deployment flag</h1>

<ul>
<li>Installs to vendor/bundle</li>
<li>Will not reuse system gems</li>
<li>Requires existing Gemfile.lock</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="bundler/3-misc">
<h1>Bundler Recommendations</h1>

<ul>
<li>Checkin Gemfile.lock to your scm so all devs on same page (also now required for deployment).</li>
<li>It works great on rails 2.3.x apps also!</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="together/together/1">
<h1>Cap &amp; Bundler Working Together</h1>

<ul>
<li>This is the hard part of the presentation....</li>
<li>Wait for it...</li>
<li>Wait for it...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="together/together/2">
<h1>Add to your Capfile</h1>

<pre style="margin-left: 200px">require 'bundler/capistrano'</pre>


<ul>
<li>This basically does a 'bundle install' after 'deploy:update_code'</li>
<li><a href="http://github.com/carlhuda/bundler/blob/master/lib/bundler/deployment.rb">Here is exactly what is does</a></li>
<li>You can always hand code it for more control.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="closing/closing/1">
<h1>So, go forth and cap/bundle your app!</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="closing/closing/2">
<h1>References</h1>

<ul>
<li><a href="http://github.com/capistrano/capistrano">Capistrano Source</a></li>
<li><a href="http://github.com/capistrano/capistrano/wiki">Capistrano Wiki</a></li>
<li><a href="http://github.com/capistrano/capistrano/wiki/2.x-Multiple-Stages-Without-Multistage-Extension">Multistage w/o capistrano-ext</a></li>
<li><a href="http://rubydoc.info/github/capistrano/capistrano/master/frames">Capistrano API Docs</a></li>
<li><a href="http://github.com/carlhuda/bundler">Bundler</a></li>
<li><a href="http://gembundler.com">Bundler Documentaiton</a></li>
<li><a href="http://github.com/schacon/showoff">Showoff</a> (presentation app)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center bigger" ref="closing/closing/3">
<h1>Thanks!</h1></div>
</div>
</div>

</body>
</html>
